<!DOCTYPE html>

<html lang="es">
<head>

<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Rastreador de Trim</title>
<style>
  /* CSS remains unchanged */
</style>
</head>
<body>
<button class="lang-toggle" onclick="toggleLanguage()">English</button>
<img alt="Banner de Rastreador de Trim" class="banner" src="trim-tracker-banner.PNG"/>
<p style="color: #ccc; max-width: 700px; margin: 0 auto 20px;">
<strong>Nota:</strong> Tus datos se guardan localmente en tu navegador y estar√°n disponibles a menos que borres tu cach√© o cambies de dispositivo o navegador. Aseg√∫rate de usar la aplicaci√≥n en tu idioma preferido, ya que los datos se almacenan por separado para cada versi√≥n. Aunque esta herramienta ayuda a rastrear datos, recomendamos hacer una copia de seguridad para evitar p√©rdidas.
</p>
<table id="sessionTable">
<thead>
<tr>
<th>Fecha</th>
<th>Variedad</th>
<th>Gramos</th>
<th>Total</th>
<th>Notas</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
<button onclick="addRow()">Agregar Fila</button>
<button class="clear-all" onclick="clearAllRows()">Borrar Todo</button>
<button onclick="exportCSV()">Exportar CSV</button>
<a class="back-link" id="backLink">‚Üê Volver a la Calculadora</a>
<div id="dailyTotals" style="margin-top: 30px; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
<h3>Totales Diarios</h3>
<ul id="totalsList" style="list-style: none; padding: 0;"></ul>
</div>

<script>
function addRow(date = '', strain = '', grams = '', total = '', notes = '') {
  const tableBody = document.getElementById('tableBody');
  const row = document.createElement('tr');

  row.innerHTML = `
    <td><input type="date" value="${date}"></td>
    <td><input type="text" value="${strain}"></td>
    <td><input type="number" value="${grams}" class="grams-input"></td>
    <td><span class="row-total">${total}</span></td>
    <td><input type="text" value="${notes}" class="notes-input"></td>
    <td>
      <button onclick="saveRow(this)">üíæ</button>
      <button onclick="deleteRow(this)">‚ùå</button>
    </td>
  `;

  tableBody.appendChild(row);
  updateTotals();
}

function saveRow(button) {
  const row = button.closest('tr');
  const inputs = row.querySelectorAll('input');
  const rowData = {
    date: inputs[0].value,
    strain: inputs[1].value,
    grams: inputs[2].value,
    total: row.querySelector('.row-total').textContent,
    notes: inputs[3].value
  };

  let savedData = JSON.parse(localStorage.getItem('trimData-es') || '[]');
  const rowIndex = Array.from(row.parentElement.children).indexOf(row);
  savedData[rowIndex] = rowData;
  localStorage.setItem('trimData-es', JSON.stringify(savedData));
}

function deleteRow(button) {
  const row = button.closest('tr');
  const rowIndex = Array.from(row.parentElement.children).indexOf(row);
  row.remove();

  let savedData = JSON.parse(localStorage.getItem('trimData-es') || '[]');
  savedData.splice(rowIndex, 1);
  localStorage.setItem('trimData-es', JSON.stringify(savedData));
  updateTotals();
}

function loadTable() {
  const savedData = JSON.parse(localStorage.getItem('trimData-es') || '[]');
  savedData.forEach(item => {
    addRow(item.date, item.strain, item.grams, item.total, item.notes);
  });
}

function updateTotals() {
  const rows = document.querySelectorAll('#tableBody tr');
  const dailyTotals = {};

  rows.forEach(row => {
    const date = row.querySelector('input[type="date"]').value;
    const grams = parseFloat(row.querySelector('.grams-input').value) || 0;
    if (!dailyTotals[date]) dailyTotals[date] = 0;
    dailyTotals[date] += grams;
    row.querySelector('.row-total').textContent = grams.toFixed(2);
  });

  const totalsList = document.getElementById('totalsList');
  totalsList.innerHTML = '';
  for (const date in dailyTotals) {
    const li = document.createElement('li');
    li.textContent = `${date}: ${dailyTotals[date].toFixed(2)}g`;
    totalsList.appendChild(li);
  }
}

function clearAllRows() {
  document.getElementById('tableBody').innerHTML = '';
  localStorage.removeItem('trimData-es');
  updateTotals();
}

function exportCSV() {
  const rows = document.querySelectorAll('#sessionTable tr');
  let csv = Array.from(rows).map(row => 
    Array.from(row.cells).map(cell => {
      const input = cell.querySelector('input');
      const span = cell.querySelector('span');
      return input ? input.value : (span ? span.textContent : cell.textContent.trim());
    }).join(',')
  ).join('\n');

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'trim-tracker.csv';
  a.click();
  URL.revokeObjectURL(url);
}

function toggleLanguage() {
  window.location.href = 'trim-tracker.html';
}

window.onload = loadTable;
</script></body>
</html>
